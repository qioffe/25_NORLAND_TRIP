<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Norland Trip Dashboard</title>
    <link rel="icon" type="image/x-icon" href="https://placehold.co/16x16/3B82F6/ffffff?text=N">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6EEF5; /* Softer, expressive background */
        }
        
        .main-container {
            border-radius: 40px; /* More pill-like, expressive shape */
            background-color: #F8FBFE;
            box-shadow: 0 12px 24px -6px rgba(0,0,0,0.1), 0 6px 12px -6px rgba(0,0,0,0.05); /* Soft, pronounced shadow */
            transition: all 0.5s cubic-bezier(0.2, 0.5, 0.4, 1.2);
            transform: translateY(20px);
            opacity: 0;
            overflow: hidden;
        }

        .main-container.is-visible {
            transform: translateY(0);
            opacity: 1;
        }

        .m3-sub-card {
            border-radius: 28px;
            background-color: #F8FBFE; /* Soft, almost white card background */
            box-shadow: 0 4px 8px -2px rgba(0,0,0,0.05);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
        }

        .m3-sub-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px -4px rgba(0,0,0,0.08);
        }
        
        .m3-sub-card.is-pressed {
            transform: scale(0.98);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .progress-container {
            height: 28px;
            background-color: #DDE8F4;
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4299E1, #3B82F6, #1D4ED8);
            transition: width 0.5s ease-in-out;
            animation: fluid-fill 3s linear infinite;
            position: relative;
        }
        .progress-text-inside {
            position: absolute;
            top: 50%;
            right: 1.5rem;
            transform: translateY(-50%);
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
            color: #334155;
            z-index: 20;
        }

        @keyframes fluid-fill {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .expressive-title {
            font-weight: 900; /* Extra bold */
            font-size: 4rem; /* Base size */
            line-height: 1;
        }
        
        /* Responsive scaling */
        @media (min-width: 640px) {
            .expressive-title {
                font-size: 7rem;
            }
        }
        
        .hero-title-gradient {
            background-image: linear-gradient(to bottom right, #3B82F6, #1D4ED8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-gradient {
            background-image: linear-gradient(to right, #4299E1, #3B82F6, #1D4ED8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            background-color: #DDE8F4; /* Lighter background for the transparent text effect */
            box-shadow: 0 4px 8px -2px rgba(0,0,0,0.05);
        }

        /* Expressive Step Progress Styles */
        .step-container {
            position: relative;
            padding-left: 5rem;
        }
        .step-item {
            position: relative;
        }
        .step-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 1.5rem; 
            top: 2rem;
            height: calc(100% - 2.5rem);
            width: 2px;
            background-color: #CBD5E1;
            z-index: 5;
        }
        .step-icon {
            position: absolute;
            left: 0; 
            top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 3rem;
            height: 3rem;
            border-radius: 9999px;
            background-color: #DDE8F4;
            color: #4B5563; /* Dark gray for visibility */
            font-weight: bold;
            transition: all 0.3s ease-in-out;
            z-index: 10;
        }
        .step-item.is-active .step-icon {
            background-color: #3B82F6;
            color: white; /* White for better contrast on blue background */
            box-shadow: 0 0 15px 5px rgba(59, 130, 246, 0.5);
        }
        .step-item.is-completed .step-icon {
            background-color: #22C55E;
            color: white; /* White for better contrast on green background */
            box-shadow: 0 0 15px 5px rgba(34, 197, 94, 0.5);
        }
        .step-content {
            margin-left: 5rem;
        }
        
        .details-card {
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
        }
        .details-card.is-visible {
            max-height: 500px;
            opacity: 1;
        }
        .expand-icon {
            transition: transform 0.3s ease-in-out;
        }
        .expand-icon.rotate-90 {
            transform: rotate(90deg);
        }

        /* Expressive Checklist Styles */
        .checklist-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background-color: #F8FBFE;
            border-radius: 28px;
            padding: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px -2px rgba(0,0,0,0.05);
        }

        .checklist-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px -4px rgba(0,0,0,0.08);
        }

        .checklist-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .checklist-item.is-completed {
            background-color: #DDE8F4;
            color: #6B7280;
            transition: all 0.5s ease-in-out;
        }

        .checklist-item.is-completed .checklist-item-header {
            opacity: 0.7;
        }

        .checklist-icon-completed {
            display: none;
            position: absolute;
            top: 1rem;
            left: 1rem;
            width: 2rem;
            height: 2rem;
            background-color: #22C55E;
            border-radius: 9999px;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.5s ease-in-out;
        }
        
        .checklist-content {
            padding-top: 1rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            opacity: 0;
            width: 100%;
        }

        .checklist-content.is-expanded {
            max-height: 500px;
            opacity: 1;
        }

        .checklist-expand-icon {
            transition: transform 0.3s ease-in-out;
        }

        .checklist-expand-icon.rotate-90 {
            transform: rotate(90deg);
        }
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        .video-overlay.is-visible {
            opacity: 1;
            visibility: visible;
        }
        .video-container {
            position: relative;
            width: 90%;
            max-width: 800px;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: white;
            color: #333;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Common Tab Styles */
        .tabs-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .tabs-container::-webkit-scrollbar {
            display: none;
        }
        .tab-btn {
            white-space: nowrap;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s, color 0.3s;
            font-weight: bold;
            font-size: 1.125rem;
            line-height: 1.75rem;
            color: #6B7280;
        }
        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px -2px rgba(0,0,0,0.05);
        }
        .tab-btn.is-active {
            background: linear-gradient(to right, #4299E1, #3B82F6, #1D4ED8);
            color: white;
            box-shadow: 4px 4px 12px -4px rgba(59, 130, 246, 0.4);
        }
        
        /* Mobile Specific Tab Styles - Re-evaluated for M3 principles */
        @media (max-width: 640px) {
            .tab-btn {
                font-size: 0.875rem;
            }
            .step-container {
                /* Reduced padding to bring the timeline closer to the edge on mobile */
                padding-left: 0.5rem;
            }
            .step-item:not(:last-child)::after {
                /* Perfect alignment with the center of the icon on mobile */
                left: 1.25rem;
                top: 1.5rem;
                height: calc(100% - 2.5rem);
            }
            .step-icon {
                width: 2.5rem;
                height: 2.5rem;
                font-size: 0.875rem;
                left: 0;
            }
            .step-content {
                /* Adjusted margin to create a consistent gutter, pushing content away from the timeline */
                margin-left: 3.5rem;
                padding: 1rem;
            }
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        .is-pulsing {
            animation: pulse-glow 2s infinite;
        }
        .hero-play-btn {
            background: linear-gradient(to right, #4299E1, #3B82F6, #1D4ED8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes subtle-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .document-link {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .document-link:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px -4px rgba(0,0,0,0.08);
        }

        .hero-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2.5rem;
            border-bottom: 2px solid rgba(221, 232, 244, 0.5); /* Light, subtle separator */
            margin-bottom: 2.5rem;
        }
        @media (min-width: 640px) {
            .hero-section {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        #travel-tips-container {
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            font-size: 1rem;
            text-align: center;
        }

        .tips-list {
            text-align: left;
            padding-left: 1rem;
        }
        .tips-list li {
            list-style: disc;
            margin-bottom: 0.5rem;
            color: #4B5563;
        }
        
        /* Spinner for loading state */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3B82F6;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center min-h-screen p-4 sm:p-6 lg:p-8 py-12 space-y-8">
    <div class="main-container w-full max-w-5xl mx-auto p-4 sm:p-6 lg:p-10">

        <!-- Updated Hero Section for Refined Mobile and Desktop Layouts -->
        <div class="hero-section group relative">
            <!-- Desktop Play Button Overlay - visible on hover on large screens -->
            <button id="play-btn-desktop" class="hidden lg:flex absolute inset-0 z-50 items-center justify-center bg-white bg-opacity-70 backdrop-blur-md rounded-[40px] opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform scale-90 group-hover:scale-100">
                <svg class="w-20 h-20 text-blue-600 transition-colors duration-200" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            </button>

            <!-- Mobile Layout -->
            <div class="flex flex-col items-start w-full lg:hidden">
                <span class="text-sm font-semibold text-gray-500 mb-2">2025 TRIP</span>

                <div class="flex items-center justify-between w-full">
                    <h1 class="expressive-title hero-title-gradient">NOV 22</h1>
                    <!-- Mobile Play Button, now aligned to the right -->
                    <button id="play-btn-mobile" class="w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-full shadow-lg bg-gray-100 transition-transform duration-200 active:scale-95" style="animation: subtle-pulse 2s infinite;">
                        <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </button>
                </div>

                <div class="flex items-center space-x-2 p-3 bg-gray-100 text-gray-700 rounded-full shadow-inner mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/>
                    </svg>
                    <span class="font-medium">Jiangsu, China</span>
                </div>
                <!-- Chips are now visible on mobile, positioned neatly under the location -->
                <div class="flex flex-wrap justify-start gap-2 w-full mt-4">
                    <div class="btn-gradient shadow-md">NORLAND</div>
                    <div class="btn-gradient shadow-md">CRAFT</div>
                    <div class="btn-gradient shadow-md">BAND</div>
                    <div class="btn-gradient shadow-md">ARTS</div>
                    <div class="btn-gradient shadow-md">DRAMA</div>
                    <div class="btn-gradient shadow-md">CHORUS</div>
                </div>
            </div>

            <!-- Desktop Layout -->
            <div class="hidden lg:flex w-full justify-between items-center">
                <div class="flex flex-col items-start w-2/3 z-10">
                    <span class="text-sm font-semibold text-gray-500 mb-2">2025 TRIP</span>
                    <h1 class="expressive-title hero-title-gradient">NOV 22</h1>
                    <div class="flex items-center space-x-2 p-3 bg-gray-100 text-gray-700 rounded-full shadow-inner mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/>
                        </svg>
                        <span class="font-medium">Jiangsu, China</span>
                    </div>
                </div>
                
                <div class="flex flex-col items-end space-y-4 w-1/3 z-10">
                    <div class="flex flex-wrap justify-end gap-2 w-full">
                        <div class="btn-gradient shadow-md">NORLAND</div>
                        <div class="btn-gradient shadow-md">CRAFT</div>
                        <div class="btn-gradient shadow-md">BAND</div>
                        <div class="btn-gradient shadow-md">ARTS</div>
                        <div class="btn-gradient shadow-md">DRAMA</div>
                        <div class="btn-gradient shadow-md">CHORUS</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="p-4 sm:p-6 lg:p-10">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 w-full">
                <div id="days-left-card" class="m3-sub-card p-6 flex flex-col items-start space-y-2 cursor-pointer" data-state="deadline">
                    <p id="countdown-days" class="text-6xl font-extrabold hero-title-gradient">0</p>
                    <p id="countdown-label" class="text-lg font-semibold text-gray-600">DAYS TO DEADLINE</p>
                </div>
                <div id="spots-left-card" class="m3-sub-card p-6 flex flex-col items-start space-y-2">
                    <p class="text-6xl font-extrabold hero-title-gradient">18</p>
                    <p class="text-lg font-semibold text-gray-600">SPOTS LEFT</p>
                </div>
                <div id="ticket-price-card" class="m3-sub-card p-6 flex flex-col items-start space-y-2">
                    <p id="ticket-price-number" class="text-6xl font-extrabold hero-title-gradient">...</p>
                    <p id="route-info" class="text-lg font-semibold text-gray-600">Loading route...</p>
                </div>
            </div>
            <div class="w-full mt-8">
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
                    <span id="progress-text" class="progress-text-inside"></span>
                </div>
            </div>
        </div>
        
        <div class="p-4 sm:p-6 lg:p-10">
            <div class="tabs-container flex sm:justify-center mb-4 overflow-x-auto relative space-x-3 py-2">
                <button id="timeline-tab-btn" class="tab-btn is-active" data-tab="timeline-tab">Application Progress</button>
                <button id="checklist-tab-btn" class="tab-btn" data-tab="checklist-tab">Checklist</button>
                <button id="documents-tab-btn" class="tab-btn" data-tab="documents-tab">Documents</button>
            </div>
            
            <div id="timeline-tab" class="tab-content" style="display:block;">
                <div id="timeline-container" class="step-container space-y-8">
                </div>
            </div>

            <div id="checklist-tab" class="tab-content" style="display:none;">
                <div id="checklist-container" class="space-y-6">
                </div>
                
                <div class="mt-8 flex justify-center">
                    <button id="generate-tips-btn" class="btn-gradient shadow-md px-6 py-3 font-bold transition-transform duration-200 active:scale-95">
                        ✨ Generate Travel Tips
                    </button>
                </div>
                
                <div id="travel-tips-container" class="m3-sub-card p-6 mt-8">
                    Click the button above to get some helpful tips for your trip!
                </div>
            </div>

            <div id="documents-tab" class="tab-content" style="display:none;">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <a href="https://qioffe.github.io/25_NORLAND_TRIP/Consent_Letter.pdf" target="_blank" rel="noopener noreferrer" class="document-link m3-sub-card p-6 flex flex-col items-center justify-center space-y-2">
                        <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
                        </svg>
                        <span class="font-bold text-blue-600 text-center">Consent Letter</span>
                    </a>
                    <a href="https://qioffe.github.io/25_NORLAND_TRIP/JESIE_application.pdf" target="_blank" rel="noopener noreferrer" class="document-link m3-sub-card p-6 flex flex-col items-center justify-center space-y-2">
                        <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
                        </svg>
                        <span class="font-bold text-blue-600 text-center">JESIE Application</span>
                    </a>
                    <a href="https://qioffe.github.io/25_NORLAND_TRIP/cova_2013.pdf" target="_blank" rel="noopener noreferrer" class="document-link m3-sub-card p-6 flex flex-col items-center justify-center space-y-2">
                        <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
                        </svg>
                        <span class="font-bold text-blue-600 text-center">Visa Application Templates</span>
                    </a>
                    <a href="https://qioffe.github.io/25_NORLAND_TRIP/WYS.pdf" target="_blank" rel="noopener noreferrer" class="document-link m3-sub-card p-6 flex flex-col items-center justify-center space-y-2">
                        <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
                        </svg>
                        <span class="font-bold text-blue-600 text-center">Where You Stay Form</span>
                    </a>
                </div>
            </div>

        </div>

        <div id="video-modal" class="video-overlay">
            <div class="video-container">
                <button id="close-btn" class="close-btn">&times;</button>
                <iframe id="youtube-player" width="560" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script>
        const timelineData = [
            {
                title: "Embarking on the Journey",
                dates: "First Stage",
                start: "2025-10-01",
                end: "2025-10-15",
                details: "This initial phase focuses on the essential steps for your visa application. We will first verify all student information and establish communication with parents. Upon completion, we will issue the official invitation letter, which is a key document for your visa packet.",
                milestones: [
                    "Complete student information verification.",
                    "Official invitation letters are issued and final data is compiled."
                ]
            },
            {
                title: "Securing Your Passage",
                dates: "Second Stage",
                start: "2025-10-16",
                end: "2025-10-31",
                details: "This is the critical phase where we finalize all visa-related paperwork. We'll work closely with parents to gather signatures and submit the complete visa packet. The goal is to collect the stamped passport by the end of this period.",
                milestones: [
                    "Final visa application forms are signed and submitted.",
                    "The visa packet is dispatched to Washington, D.C.",
                    "The stamped visa passport is collected."
                ]
            },
            {
                title: "Finalizing Your Preparations",
                dates: "Third Stage",
                start: "2025-11-01",
                end: "2025-11-30",
                details: "The final stages of preparation focus on logistics and finance. We will complete the last two payments, ensuring everything is in place for a smooth and worry-free departure.",
                milestones: [
                    "The second payment is due.",
                    "The third and final payment is due."
                ]
            }
        ];

        const checklistData = [
            {
                title: "Notarized Consent Letter",
                content: "A notarized consent letter is required if a parent is not accompanying the minor."
            },
            {
                title: "Passport & Identification",
                content: "<ul><li>Passport – valid for at least six (6) months, with a minimum of two (2) blank visa pages.</li><li>Photocopy of passport bio-page.</li><li>Birth Certificate for minor applicant.</li></ul>"
            },
            {
                title: "COVA Visa Form",
                content: 'Completed online at <a href="https://cova.mfa.gov.cn/qzCoCommonController.do?show&pageId=index&locale=en_US" target="_blank" class="text-blue-600 hover:underline" rel="noopener noreferrer">COVA Form</a>, printed in full (8–9 pages).'
            },
            {
                title: "Supporting Documentation",
                content: '<ul><li>Photocopy of most recent Chinese visa or residence permit, if applicable.</li><li>Proof of residence in the United States.</li><li>Completed “Where You Stay” Form.</li></ul>'
            },
            {
                title: "Invitation Letter",
                content: "Includes minor’s full name, purpose of visit, intended dates, places to visit, inviter info, official seal/signature, and date of issuance."
            }
        ];

        const renderTimeline = () => {
            const container = document.getElementById('timeline-container');
            container.innerHTML = timelineData.map((step, index) => {
                const milestonesHtml = step.milestones.map(m => `<li>${m}</li>`).join('');
                return `
                    <div class="step-item" data-start="${step.start}" data-end="${step.end}">
                        <div class="step-icon">${index + 1}</div>
                        <div class="step-content m3-sub-card p-6">
                            <div class="flex justify-between items-center">
                                <div class="flex flex-col">
                                    <span class="font-bold text-blue-600">${step.title}</span>
                                    <span class="text-sm text-gray-500">${step.dates}</span>
                                </div>
                                <span class="expand-icon text-gray-400">&#9656;</span>
                            </div>
                            <div class="details-card">
                                <div class="p-4 mt-2">
                                    <p class="text-sm text-gray-700 mb-2">${step.details}</p>
                                    <h3 class="font-semibold text-gray-800 mb-2">Key Milestones:</h3>
                                    <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                                        ${milestonesHtml}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        };

        const renderChecklist = () => {
            const container = document.getElementById('checklist-container');
            container.innerHTML = checklistData.map(item => `
                <div class="checklist-item" data-expanded="false">
                    <button class="checklist-icon-completed" aria-label="Mark as complete">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </button>
                    <div class="checklist-item-header">
                        <span class="font-bold text-blue-600">${item.title}</span>
                        <span class="expand-icon text-gray-400 checklist-expand-icon">&#9656;</span>
                    </div>
                    <div class="checklist-content">
                        <p class="leading-relaxed text-gray-700">${item.content}</p>
                    </div>
                </div>
            `).join('');
        };

        const updateStepProgress = () => {
            const now = new Date();
            const steps = document.querySelectorAll('.step-item');
            
            steps.forEach((step, index) => {
                const startDate = new Date(step.dataset.start);
                const endDate = new Date(step.dataset.end);
                
                step.classList.remove('is-active', 'is-completed');

                if (now >= endDate) {
                    step.classList.add('is-completed');
                } else if (now >= startDate && now < endDate) {
                    step.classList.add('is-active');
                } else if (index === 0) {
                     step.classList.add('is-active');
                }
            });
        };

        const updateCountdownAndProgress = () => {
            const deadlineDate = new Date('2025-09-15T00:00:00');
            const tripDate = new Date('2025-11-22T00:00:00');
            const now = new Date();

            // Calculate days for both deadlines
            const daysToTrip = Math.ceil((tripDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
            const daysToDeadline = Math.ceil((deadlineDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
            
            // Set initial display to the deadline countdown
            const countdownElement = document.getElementById('countdown-days');
            const countdownLabel = document.getElementById('countdown-label');
            const daysLeftCard = document.getElementById('days-left-card');

            if (daysLeftCard.dataset.state === 'deadline') {
                countdownElement.textContent = daysToDeadline > 0 ? daysToDeadline : 0;
                countdownLabel.textContent = "DAYS TO DEADLINE";
            } else {
                countdownElement.textContent = daysToTrip > 0 ? daysToTrip : 0;
                countdownLabel.textContent = "DAYS TO DEPARTURE";
            }


            // Progress bar logic remains tied to the deadline
            const startDate = new Date('2025-09-02T00:00:00');
            const totalTime = deadlineDate.getTime() - startDate.getTime();
            const elapsedTime = now.getTime() - startDate.getTime();

            let progressPercentage = 0;
            let progressText = "September 15th deadline";
            if (now >= deadlineDate) {
                progressPercentage = 100;
                progressText = "Deadline reached!";
            } else if (now > startDate) {
                progressPercentage = (elapsedTime / totalTime) * 100;
            } else {
                 progressText = "Countdown starts soon...";
            }

            const progressBar = document.getElementById('progress-bar');
            if (progressBar) {
                progressBar.style.width = `${progressPercentage}%`;
            }

            const progressTextElement = document.getElementById('progress-text');
            if (progressTextElement) {
                progressTextElement.textContent = progressText;
            }
        };

        const updateTicketPrice = async () => {
            const priceElement = document.getElementById('ticket-price-number');
            const routeElement = document.getElementById('route-info');
            if (!priceElement || !routeElement) return;

            try {
                // Add a unique timestamp to defeat browser caching
                const response = await fetch('data.json?t=' + new Date().getTime());
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.price) {
                    priceElement.textContent = `$${data.price}`;
                } else {
                    priceElement.textContent = "N/A";
                    console.error("No price found in data.json or API error:", data.status);
                }

                if (data.route_info) {
                    routeElement.textContent = data.route_info;
                } else {
                    routeElement.textContent = "N/A";
                }

            } catch (error) {
                priceElement.textContent = "Error";
                routeElement.textContent = "Error";
                console.error("Failed to fetch ticket price from data.json:", error);
            }
        };

        const setupEventListeners = () => {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const tabId = e.currentTarget.dataset.tab;
                    

                    tabButtons.forEach(btn => {
                        btn.classList.remove('is-active');
                    });

                    tabContents.forEach(content => {
                        content.style.display = 'none';
                    });

                    document.getElementById(tabId).style.display = 'block';
                    e.currentTarget.classList.add('is-active');
                });
            });

            document.addEventListener('click', (e) => {
                // Timeline accordion and highlight
                const timelineItem = e.target.closest('.step-item');
                if (timelineItem) {
                    // Remove is-active from all steps
                    document.querySelectorAll('.step-item').forEach(step => {
                        step.classList.remove('is-active');
                    });

                    // Add is-active to the clicked item
                    timelineItem.classList.add('is-active');

                    // Toggle details card
                    const detailsCard = timelineItem.querySelector('.details-card');
                    const expandIcon = timelineItem.querySelector('.expand-icon');
                    if (detailsCard && expandIcon) {
                        detailsCard.classList.toggle('is-visible');
                        expandIcon.classList.toggle('rotate-90');
                    }
                }

                // Checklist accordion and completion
                const checklistItem = e.target.closest('.checklist-item');
                if (checklistItem) {
                    // Toggle expansion if the click is not on the completion button
                    if (!e.target.closest('.checklist-icon-completed')) {
                        const content = checklistItem.querySelector('.checklist-content');
                        const isExpanded = content.classList.toggle('is-expanded');
                        checklistItem.querySelector('.checklist-expand-icon').classList.toggle('rotate-90', isExpanded);
                    } else {
                        checklistItem.classList.toggle('is-completed');
                    }
                }
            });

            // Video player functionality
            const playButtonDesktop = document.getElementById('play-btn-desktop');
            const playButtonMobile = document.getElementById('play-btn-mobile');
            const videoModal = document.getElementById('video-modal');
            const closeButton = document.getElementById('close-btn');
            const youtubePlayer = document.getElementById('youtube-player');
            const videoUrl = 'https://www.youtube.com/embed/UsciZfWn2ig?autoplay=1';
            
            if (playButtonDesktop) {
                playButtonDesktop.addEventListener('click', () => {
                    youtubePlayer.src = videoUrl;
                    videoModal.classList.add('is-visible');
                });
            }

            if (playButtonMobile) {
                playButtonMobile.addEventListener('click', () => {
                    youtubePlayer.src = videoUrl;
                    videoModal.classList.add('is-visible');
                });
            }


            closeButton.addEventListener('click', () => {
                youtubePlayer.src = ''; // Stop the video
                videoModal.classList.remove('is-visible');
            });

            videoModal.addEventListener('click', (event) => {
                if (event.target === videoModal) {
                    youtubePlayer.src = '';
                    videoModal.classList.remove('is-visible');
                }
            });
            
            // Days Left Card Toggle
            const daysLeftCard = document.getElementById('days-left-card');
            if (daysLeftCard) {
                daysLeftCard.addEventListener('click', () => {
                    if (daysLeftCard.dataset.state === 'deadline') {
                        daysLeftCard.dataset.state = 'trip';
                    } else {
                        daysLeftCard.dataset.state = 'deadline';
                    }
                    updateCountdownAndProgress(); // Update display based on new state
                });
            }

            // Gemini API call for Travel Tips
            const generateTipsBtn = document.getElementById('generate-tips-btn');
            if(generateTipsBtn) {
                generateTipsBtn.addEventListener('click', async () => {
                    const tipsContainer = document.getElementById('travel-tips-container');
                    const originalContent = tipsContainer.innerHTML;
                    
                    tipsContainer.innerHTML = `<div class="flex flex-col items-center justify-center p-4"><div class="spinner"></div><p class="mt-4 text-gray-500 text-sm">Generating tips...</p></div>`;

                    try {
                        const userQuery = "Generate a list of 5 essential travel tips for a trip to Jiangsu, China in November 2025. Be concise and actionable, focusing on a student group. The output should be a single JSON object with a key 'tips' and a value of an array of strings.";
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const payload = {
                            contents: [{ parts: [{ text: userQuery }] }],
                            generationConfig: {
                                responseMimeType: "application/json",
                                responseSchema: {
                                    type: "OBJECT",
                                    properties: {
                                        "tips": {
                                            "type": "ARRAY",
                                            "items": { "type": "STRING" }
                                        }
                                    }
                                }
                            }
                        };
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`API error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        const candidate = result.candidates?.[0];
                        
                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const jsonText = candidate.content.parts[0].text;
                            const parsedJson = JSON.parse(jsonText);
                            const tips = parsedJson.tips;
                            
                            if (Array.isArray(tips) && tips.length > 0) {
                                const tipsHtml = tips.map(tip => `<li>${tip}</li>`).join('');
                                tipsContainer.innerHTML = `<ul class="tips-list space-y-2">${tipsHtml}</ul>`;
                            } else {
                                tipsContainer.innerHTML = `<p class="text-red-500">Failed to generate tips. Please try again.</p>`;
                            }
                        } else {
                            tipsContainer.innerHTML = `<p class="text-red-500">Failed to generate tips. The response was empty.</p>`;
                        }
                    } catch (error) {
                        console.error('Error generating travel tips:', error);
                        tipsContainer.innerHTML = `<p class="text-red-500">An error occurred. Please check the console for details.</p>`;
                    }
                });
            }
        };

        const setupCardInteractions = () => {
            const daysLeftCard = document.getElementById('days-left-card');
            const spotsLeftCard = document.getElementById('spots-left-card');
            const ticketPriceCard = document.getElementById('ticket-price-card');
            
            const addPressListeners = (card) => {
                card.addEventListener('mousedown', () => card.classList.add('is-pressed'));
                card.addEventListener('mouseup', () => card.classList.remove('is-pressed'));
                card.addEventListener('mouseleave', () => card.classList.remove('is-pressed'));
                card.addEventListener('touchstart', () => card.classList.add('is-pressed'), { passive: true });
                card.addEventListener('touchend', () => card.classList.remove('is-pressed'));
            };
            
            addPressListeners(daysLeftCard);
            addPressListeners(spotsLeftCard);
            addPressListeners(ticketPriceCard);
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderTimeline();
            renderChecklist();
            setupEventListeners();
            setupCardInteractions();
            
            // Animate cards on load
            const containers = document.querySelectorAll('.main-container');
            containers.forEach((container, index) => {
                setTimeout(() => {
                    container.classList.add('is-visible');
                }, index * 200);
            });
            
            const daysLeftCard = document.getElementById('days-left-card');
            if (daysLeftCard) {
                daysLeftCard.classList.add('is-pulsing');
            }
            
            updateStepProgress();
            setInterval(updateStepProgress, 1000 * 60); // Update step progress every minute
            updateCountdownAndProgress();
            setInterval(updateCountdownAndProgress, 1000 * 60); // Update countdown and progress every minute
            updateTicketPrice();
            setInterval(updateTicketPrice, 5000); // Update ticket price every 5 seconds

            // Show the timeline tab by default
            const timelineButton = document.getElementById('timeline-tab-btn');
            if (timelineButton) {
                timelineButton.click();
            }
        });
    </script>
</body>
</html>
